<!--
SPDX-FileCopyrightText: 2020 Ethel Morgan

SPDX-License-Identifier: MIT
-->

<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<title>home</title>
	<style>
	@media (prefers-color-scheme: dark) {
		body {
			background: #1f1f1f;
			color: #ddd;
		}
		input, button, select {
			display: block;
		}
	}
	</style>
</head>
<body>
	<h1>edelheim</h1>
	<main id='home'></main>
	<script type='module'>
		import { UI } from './ui.js';
		import { elemRegister } from './elems.js';

	  	elemRegister( '_', null, 'button', 'div', 'input', 'h2', 'h3', 'label', 'main', 'p', 'section' );

                function sendMessage( path, data ) {
			console.log( `sent a message: ${path}: ${data}` );
                }

		const main = document.getElementById( 'home' );
		const ui = new UI( { rootElement: main, topicPrefix: 'home', sendMessageFunction: sendMessage } );

		// TEST DATA.

		Array.prototype.random = function() {
			return this[ Math.floor( Math.random() * this.length ) ];
		}

		const rooms = [
			'bedroom',
			'kitchen',
			'living-room',
		];
		const devices = [
			'light',
			'speakers',
			'tv',
		];
		const controls = [
			'input_enum',
			'input_enum/values',
			'power',
			'temperature_celsius',
			'volume_percent',
		];
		const controlValues = {
			'input_enum': [ 'upnp', 'airplay' ],
			'input_enum/values': [ 'upnp\nairplay', 'tv\nairplay' ],
			'power': [ 'on', 'off' ],
			'temperature_celsius': [ 18, 19, 20, 21 ],
			'volume_percent': [ 11, 30, 42 ],
		};

		window.setInterval( () => {
			const room    = rooms.random();
			const device  = devices.random();
			const control = controls.random();
			const value   = controlValues[ control ].random();

			const topic = `home/${room}/${device}/${control}`
			ui.set( topic, value );
			console.log( `${topic}: ${value}` );
		}, 1000 );
	</script>
</body>
</html>
